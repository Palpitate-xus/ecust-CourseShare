C51 COMPILER V9.54   MOTOR                                                                 07/03/2023 16:13:51 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE MOTOR
OBJECT MODULE PLACED IN .\Objects\motor.obj
COMPILER INVOKED BY: E:\ele\keil\C51\BIN\C51.EXE motor.c LARGE OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listi
                    -ngs\motor.lst) OBJECT(.\Objects\motor.obj)

line level    source

   1          #include <REG52.h>
   2          #include <motor.h>
   3          
   4          unsigned char tick;
   5          int Speed;
   6          extern unsigned char motorMode;
   7          
   8          extern unsigned char key,lastKey;
   9          
  10          unsigned char tempMax;
  11          unsigned char tempMin;
  12          
  13          extern const unsigned char Number[10];
  14          extern unsigned char LED[8];
  15          
  16          void motorTest(unsigned char sped)
  17          {
  18   1          EA = 1;
  19   1          
  20   1          Speed = sped;
  21   1          
  22   1          LED[0] = LED_NULL;
  23   1          LED[1] = Number[Speed / 100];
  24   1          LED[2] = Number[(Speed / 10) % 10];
  25   1          LED[3] = Number[Speed %10];
  26   1          LED[4] = LED_NULL;
  27   1          LED[5] = LED_r;
  28   1          LED[6] = Number[(motorMode + 1) / 10];
  29   1          LED[7] = Number[(motorMode + 1) % 10];
  30   1      
  31   1      }
  32          
  33          void motorControl(float temp)
  34          {
  35   1          EA = 1;
  36   1          if(temp >= (float)tempMax)
  37   1          {
  38   2              Speed = 100;
  39   2          }
  40   1          else if(temp <= (float)tempMin)
  41   1          {
  42   2              Speed = 0;
  43   2          }
  44   1          else 
  45   1          {
  46   2              Speed = 50 * ((temp - tempMin) / (tempMax - tempMin)) + 50;
  47   2          }
  48   1          LED[4] = LED_NULL;
  49   1          LED[5] = Number[Speed / 100];
  50   1          LED[6] = Number[(Speed % 100) / 10];
  51   1          LED[7] = Number[Speed % 10];
  52   1      }
  53          
  54          void init_motor(void)
C51 COMPILER V9.54   MOTOR                                                                 07/03/2023 16:13:51 PAGE 2   

  55          {
  56   1          TMOD |= 0x01;
  57   1          TH0 = 0xfe;
  58   1          TL0 = 0x00;
  59   1          
  60   1          TR0 = 1;
  61   1          ET0 = 1;
  62   1          EA = 0;
  63   1          
  64   1          motor = 0;
  65   1          motorMode = 0;
  66   1          
  67   1          tempMin = readByte_ee(10);
  68   1          tempMax = readByte_ee(11);
  69   1          Speed = 50;
  70   1      }
  71          
  72          int setSpeed(float speedDelta)
  73          {
  74   1          Speed = Speed + speedDelta;
  75   1          
  76   1          if(Speed > 100) Speed = 100;
  77   1          else if(Speed < 0) Speed = 0;
  78   1          return Speed;
  79   1      }
  80          
  81          
  82          
  83          void pwmMotor(void) interrupt 1
  84          {
  85   1          TH0 = 0xfe;
  86   1              TL0 = 0x00;
  87   1              tick++; 
  88   1              if(tick > 100)  
  89   1              {                               
  90   2                      tick = 0;
  91   2              }
  92   1      
  93   1              if(100 - Speed < tick)
  94   1              {
  95   2                      motor = 1;      
  96   2              }
  97   1              else
  98   1              {
  99   2                      motor = 0;      
 100   2              }
 101   1      
 102   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    718    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      5       8
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
